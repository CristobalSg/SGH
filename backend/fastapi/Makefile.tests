# Makefile para gestiÃ³n de pruebas - SGH Backend

# Variables
PYTHON := python
PYTEST := $(PYTHON) -m pytest
SHELL := /bin/bash
TEST_DIR := tests
COVERAGE_DIR := htmlcov

# Colores para output
GREEN := \033[0;32m
RED := \033[0;31m
YELLOW := \033[1;33m
NC := \033[0m # No Color

.PHONY: help test test-verbose test-cov test-cov-html test-unit test-integration install-test clean-cov \
         test-docente test-asignatura test-clase test-seccion test-bloque test-restriccion test-restriccion-horario test-auth \
         test-auth-api test-db-api test-main-api test-restricciones-api test-restriccion-horario-api \
         test-docente-cov test-asignatura-cov test-clase-cov test-seccion-cov test-bloque-cov test-restriccion-cov test-restriccion-horario-cov test-auth-cov

help: ## Mostrar ayuda
	@echo "$(GREEN)Comandos disponibles:$(NC)"
	@echo "$(YELLOW)â•â•â• Comandos Generales â•â•â•$(NC)"
	@echo "  $(YELLOW)test$(NC)                    - Ejecutar todas las pruebas"
	@echo "  $(YELLOW)test-verbose$(NC)            - Ejecutar todas las pruebas con salida verbose"
	@echo "  $(YELLOW)test-unit$(NC)               - Ejecutar solo pruebas unitarias"
	@echo "  $(YELLOW)test-integration$(NC)        - Ejecutar solo pruebas de integraciÃ³n"
	@echo "  $(YELLOW)test-cov$(NC)                - Ejecutar pruebas con reporte de cobertura"
	@echo "  $(YELLOW)test-cov-html$(NC)           - Ejecutar pruebas con reporte HTML de cobertura"
	@echo ""
	@echo "$(YELLOW)â•â•â• Pruebas Unitarias EspecÃ­ficas â•â•â•$(NC)"
	@echo "  $(YELLOW)test-docente$(NC)            - Ejecutar pruebas de Docente"
	@echo "  $(YELLOW)test-asignatura$(NC)         - Ejecutar pruebas de Asignatura"
	@echo "  $(YELLOW)test-clase$(NC)              - Ejecutar pruebas de Clase"
	@echo "  $(YELLOW)test-seccion$(NC)            - Ejecutar pruebas de Seccion"
	@echo "  $(YELLOW)test-bloque$(NC)             - Ejecutar pruebas de Bloque"
	@echo "  $(YELLOW)test-restriccion$(NC)        - Ejecutar pruebas de Restriccion"
	@echo "  $(YELLOW)test-restriccion-horario$(NC) - Ejecutar pruebas de RestriccionHorario"
	@echo "  $(YELLOW)test-auth$(NC)               - Ejecutar pruebas de AutenticaciÃ³n"
	@echo ""
	@echo "$(YELLOW)â•â•â• Pruebas de API â•â•â•$(NC)"
	@echo "  $(YELLOW)test-auth-api$(NC)           - Ejecutar pruebas de API de AutenticaciÃ³n"
	@echo "  $(YELLOW)test-db-api$(NC)             - Ejecutar pruebas de API de DB"
	@echo "  $(YELLOW)test-main-api$(NC)           - Ejecutar pruebas de API principal"
	@echo "  $(YELLOW)test-restricciones-api$(NC)  - Ejecutar pruebas de API de Restricciones"
	@echo "  $(YELLOW)test-restriccion-horario-api$(NC) - Ejecutar pruebas de API de RestriccionHorario"
	@echo ""
	@echo "$(YELLOW)â•â•â• Pruebas con Cobertura EspecÃ­ficas â•â•â•$(NC)"
	@echo "  $(YELLOW)test-docente-cov$(NC)        - Ejecutar pruebas de Docente con cobertura"
	@echo "  $(YELLOW)test-asignatura-cov$(NC)     - Ejecutar pruebas de Asignatura con cobertura"
	@echo "  $(YELLOW)test-clase-cov$(NC)          - Ejecutar pruebas de Clase con cobertura"
	@echo "  $(YELLOW)test-seccion-cov$(NC)        - Ejecutar pruebas de Seccion con cobertura"
	@echo "  $(YELLOW)test-bloque-cov$(NC)         - Ejecutar pruebas de Bloque con cobertura"
	@echo "  $(YELLOW)test-restriccion-cov$(NC)    - Ejecutar pruebas de Restriccion con cobertura"
	@echo "  $(YELLOW)test-restriccion-horario-cov$(NC) - Ejecutar pruebas de RestriccionHorario con cobertura"
	@echo "  $(YELLOW)test-auth-cov$(NC)           - Ejecutar pruebas de Auth con cobertura"
	@echo ""
	@echo "$(YELLOW)â•â•â• Utilidades â•â•â•$(NC)"
	@echo "  $(YELLOW)install-test$(NC)            - Instalar dependencias de testing"
	@echo "  $(YELLOW)clean-cov$(NC)               - Limpiar archivos de cobertura"
	@echo "  $(YELLOW)watch-test$(NC)              - Ejecutar pruebas en modo watch"
	@echo "  $(YELLOW)lint-tests$(NC)              - Verificar estilo de cÃ³digo en pruebas"

test: ## Ejecutar todas las pruebas
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas...$(NC)"
	$(PYTEST) $(TEST_DIR)

test-verbose: ## Ejecutar todas las pruebas con salida verbose
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas (verbose)...$(NC)"
	$(PYTEST) $(TEST_DIR) -v

test-unit: ## Ejecutar solo pruebas unitarias
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas unitarias...$(NC)"
	$(PYTEST) $(TEST_DIR)/application -v

test-integration: ## Ejecutar solo pruebas de integraciÃ³n
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de integraciÃ³n...$(NC)"
	$(PYTEST) $(TEST_DIR)/integration -v

# â•â•â• Pruebas Unitarias EspecÃ­ficas â•â•â•

test-docente: ## Ejecutar solo pruebas de Docente
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de Docente...$(NC)"
	$(PYTEST) $(TEST_DIR)/application/use_cases/test_docente_use_cases.py -v

test-asignatura: ## Ejecutar solo pruebas de Asignatura
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de Asignatura...$(NC)"
	$(PYTEST) $(TEST_DIR)/application/use_cases/test_asignatura_use_cases.py -v

test-clase: ## Ejecutar solo pruebas de Clase
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de Clase...$(NC)"
	$(PYTEST) $(TEST_DIR)/application/use_cases/test_clase_use_cases.py -v

test-seccion: ## Ejecutar solo pruebas de Seccion
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de Seccion...$(NC)"
	$(PYTEST) $(TEST_DIR)/application/use_cases/test_seccion_use_cases.py -v

test-bloque: ## Ejecutar solo pruebas de Bloque
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de Bloque...$(NC)"
	$(PYTEST) $(TEST_DIR)/application/use_cases/test_bloque_use_cases.py -v

test-restriccion: ## Ejecutar solo pruebas de Restriccion
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de Restriccion...$(NC)"
	$(PYTEST) $(TEST_DIR)/application/use_cases/test_restriccion_use_cases.py -v

test-restriccion-horario: ## Ejecutar solo pruebas de RestriccionHorario
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de RestriccionHorario...$(NC)"
	$(PYTEST) $(TEST_DIR)/application/use_cases/test_restriccion_horario_use_cases.py -v

test-auth: ## Ejecutar solo pruebas de AutenticaciÃ³n
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de AutenticaciÃ³n...$(NC)"
	$(PYTEST) $(TEST_DIR)/application/use_cases/test_user_auth_use_cases.py -v

# â•â•â• Pruebas de API â•â•â•

test-auth-api: ## Ejecutar solo pruebas de API de AutenticaciÃ³n
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de API de AutenticaciÃ³n...$(NC)"
	$(PYTEST) $(TEST_DIR)/integration/test_auth_api.py -v

test-db-api: ## Ejecutar solo pruebas de API de DB
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de API de DB...$(NC)"
	$(PYTEST) $(TEST_DIR)/integration/test_db_api.py -v

test-main-api: ## Ejecutar solo pruebas de API principal
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de API principal...$(NC)"
	$(PYTEST) $(TEST_DIR)/integration/test_main_api.py -v

test-restricciones-api: ## Ejecutar solo pruebas de API de Restricciones
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de API de Restricciones...$(NC)"
	$(PYTEST) $(TEST_DIR)/integration/test_restricciones_api.py -v

test-restriccion-horario-api: ## Ejecutar solo pruebas de API de RestriccionHorario
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de API de RestriccionHorario...$(NC)"
	$(PYTEST) $(TEST_DIR)/integration/test_restriccion_horario_api.py -v

test-api: ## Ejecutar solo pruebas de API de restricciones
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de API de restricciones...$(NC)"
	$(PYTEST) $(TEST_DIR)/integration/test_restricciones_api.py -v

test-cov: ## Ejecutar pruebas con reporte de cobertura
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas con cobertura...$(NC)"
	$(PYTEST) $(TEST_DIR) \
		--cov=application \
		--cov=domain \
		--cov=infrastructure \
		--cov-report=term-missing \
		--cov-report=xml

test-cov-html: ## Ejecutar pruebas con reporte HTML de cobertura
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas con cobertura HTML...$(NC)"
	$(PYTEST) $(TEST_DIR) \
		--cov=application \
		--cov=domain \
		--cov=infrastructure \
		--cov-report=html:$(COVERAGE_DIR) \
		--cov-report=term-missing
	@echo "$(YELLOW)ğŸ“Š Reporte HTML generado en: $(COVERAGE_DIR)/index.html$(NC)"

test-restriccion-horario-cov: ## Ejecutar pruebas de RestriccionHorario con cobertura
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de RestriccionHorario con cobertura...$(NC)"
	$(PYTEST) \
		$(TEST_DIR)/application/use_cases/test_restriccion_horario_use_cases.py \
		--cov=application.use_cases.restriccion_horario_use_cases \
		--cov-report=term-missing \
		-v

test-api-cov: ## Ejecutar pruebas de API con cobertura
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de API con cobertura...$(NC)"
	$(PYTEST) \
		$(TEST_DIR)/integration/test_restricciones_api.py \
		--cov=infrastructure.controllers.restriccion_controller \
		--cov=application.use_cases.restriccion_use_cases \
		--cov-report=term-missing \
		-v

# â•â•â• Pruebas con Cobertura EspecÃ­ficas â•â•â•

test-docente-cov: ## Ejecutar pruebas de Docente con cobertura
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de Docente con cobertura...$(NC)"
	$(PYTEST) \
		$(TEST_DIR)/application/use_cases/test_docente_use_cases.py \
		--cov=application.use_cases.docente_use_cases \
		--cov-report=term-missing \
		-v

test-asignatura-cov: ## Ejecutar pruebas de Asignatura con cobertura
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de Asignatura con cobertura...$(NC)"
	$(PYTEST) \
		$(TEST_DIR)/application/use_cases/test_asignatura_use_cases.py \
		--cov=application.use_cases.asignatura_use_cases \
		--cov-report=term-missing \
		-v

test-clase-cov: ## Ejecutar pruebas de Clase con cobertura
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de Clase con cobertura...$(NC)"
	$(PYTEST) \
		$(TEST_DIR)/application/use_cases/test_clase_use_cases.py \
		--cov=application.use_cases.clase_use_cases \
		--cov-report=term-missing \
		-v

test-seccion-cov: ## Ejecutar pruebas de Seccion con cobertura
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de Seccion con cobertura...$(NC)"
	$(PYTEST) \
		$(TEST_DIR)/application/use_cases/test_seccion_use_cases.py \
		--cov=application.use_cases.seccion_use_cases \
		--cov-report=term-missing \
		-v

test-bloque-cov: ## Ejecutar pruebas de Bloque con cobertura
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de Bloque con cobertura...$(NC)"
	$(PYTEST) \
		$(TEST_DIR)/application/use_cases/test_bloque_use_cases.py \
		--cov=application.use_cases.bloque_use_cases \
		--cov-report=term-missing \
		-v

test-restriccion-cov: ## Ejecutar pruebas de Restriccion con cobertura
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de Restriccion con cobertura...$(NC)"
	$(PYTEST) \
		$(TEST_DIR)/application/use_cases/test_restriccion_use_cases.py \
		--cov=application.use_cases.restriccion_use_cases \
		--cov-report=term-missing \
		-v

test-auth-cov: ## Ejecutar pruebas de AutenticaciÃ³n con cobertura
	@echo "$(GREEN)ğŸ§ª Ejecutando pruebas de AutenticaciÃ³n con cobertura...$(NC)"
	$(PYTEST) \
		$(TEST_DIR)/application/use_cases/test_user_auth_use_cases.py \
		--cov=application.use_cases.user_auth_use_cases \
		--cov-report=term-missing \
		-v

install-test: ## Instalar dependencias de testing
	@echo "$(GREEN)ğŸ“¦ Instalando dependencias de testing...$(NC)"
	pip install pytest pytest-asyncio pytest-cov

clean-cov: ## Limpiar archivos de cobertura
	@echo "$(GREEN)ğŸ§¹ Limpiando archivos de cobertura...$(NC)"
	rm -rf $(COVERAGE_DIR)
	rm -f .coverage
	rm -f coverage.xml

# Targets para desarrollo
watch-test: ## Ejecutar pruebas en modo watch (requiere pytest-watch)
	@echo "$(GREEN)ğŸ‘€ Ejecutando pruebas en modo watch...$(NC)"
	pip install pytest-watch
	ptw $(TEST_DIR)

lint-tests: ## Verificar estilo de cÃ³digo en pruebas
	@echo "$(GREEN)ğŸ” Verificando estilo de cÃ³digo en pruebas...$(NC)"
	flake8 $(TEST_DIR) --max-line-length=100

# Target por defecto
.DEFAULT_GOAL := help
